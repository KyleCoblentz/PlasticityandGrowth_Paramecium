summary(mod_1_growth)
plot(mod_1_growth)
mod_2_growth <- brm(formula = Growth.Rate.Hours ~ poly(Temperature, 2, raw = TRUE) + (1 + poly(Temperature, 1, raw = TRUE)|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
summary(mod_2_growth)
plot(mod_2_growth)
conditional_effects(mod_2_growth)
mod_3_growth <- brm(formula = Growth.Rate.Hours ~ poly(Temperature, 2, raw = TRUE) + (1 + poly(Temperature, 2, raw = TRUE)|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
summary(mod_4_growth)
summary(mod_3_growth)
conditional_effects(mod_3_growth)
mod_3_growth_loo <- loo(mod_3_growth)
mod_4_growth <- brm(formula = Growth.Rate.Hours ~ poly(Temperature, 3, raw = TRUE) + (1|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
summary(mod_4_growth)
plot(mod_4_growth)
conditional_effects(mod_4_growth)
mod_4_growth <- brm(formula = Growth.Rate.Hours ~ poly(Temperature, 3, raw = TRUE) + (1|Genotype) + (1|Date.paramecium.introduced), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
summary(mod_4_growth)
plot(mod_4_growth)
conditional_effects(mod_4_growth)
ggplot(data = growth_data, aes(x = Temperature, y = Growth.Rate.Hours, color = Genotype)) +
geom_point() + geom_smooth(method = 'gam', formula = y ~ s(x, bs = 'tp', k = 6), se = FALSE)
growth_data <- growth_data %>% mutate(growth_days = Growth.Rate.Hours*24)
ggplot(data = growth_data, aes(x = Temperature, y = growth_days, color = Genotype)) +
geom_point() + geom_smooth(method = 'gam', formula = y ~ s(x, bs = 'tp', k = 6), se = FALSE)
mod_1_growth <- brm(formula = growth_days ~ poly(Temperature, 2, raw = TRUE) + (1|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
summary(mod_1_growth)
plot(mod_1_growth)
conditional_effects(mod_1_growth)
mod_1_growth_loo <- loo(mod_1_growth)
mod_2_growth <- brm(formula = Growth.Rate.Hours ~ poly(Temperature, 2, raw = TRUE) + (1 + poly(Temperature, 1, raw = TRUE)|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
ggplot(data = filter(ind_data, Genotype == "G30"), aes(x = Temperature, y = mean_major)) +
geom_point() + geom_line(data = filter(predict_mean_major, Genotype == "G30"), aes(x = Temperature, y = Prediction))
ggplot(data = filter(ind_data, Genotype == "G20"), aes(x = Temperature, y = mean_major)) +
geom_point() + geom_line(data = filter(predict_mean_major, Genotype == "G20"), aes(x = Temperature, y = Prediction))
summary(mod_2_growth)
mod_2_growth <- brm(formula = Growth.Rate.Hours ~ poly(Temperature, 2, raw = TRUE) + (1 + Temperature|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
mod_2_growth <- brm(formula = growth_days ~ poly(Temperature, 2, raw = TRUE) + (1 + Temperature|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
summary(mod_2_growth)
plot(mod_2_growth)
conditional_effects(mod_2_growth)
mod_2_growth_loo <- loo(mod_2_growth)
mod_3_growth <- brm(formula = growth_days ~ poly(Temperature, 2, raw = TRUE) + (1 + poly(Temperature, 2, raw = TRUE)|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
summary(mod_3_growth)
plot(mod_3_growth)
conditional_effects(mod_3_growth)
mod_3_growth_loo <- loo(mod_3_growth)
mod_4_growth <- brm(formula = growth_days ~ poly(Temperature, 3, raw = TRUE) + (1|Genotype) + (1|Date.paramecium.introduced), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
mod_4_growth <- brm(formula = growth_days ~ poly(Temperature, 3, raw = TRUE) + (1|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
summary(mod_4_growth)
plot(mod_4_growth)
conditional_effects(mod_4_growth)
mod_4_growth <- brm(formula = growth_days ~ poly(Temperature, 4, raw = TRUE) + (1|Genotype), data = growth_data,
backend = 'cmdstanr', cores = getOption("mc.cores", 1))
summary(mod_4_growth)
plot(mod_4_growth)
conditional_effects(mod_4_growth)
new_data <- data.frame(Genotype = unique(growth_data$Genotype), Temperatureunique(growth_data$Temperature))
new_data <- data.frame(Genotype = unique(growth_data$Genotype), Temperature = unique(growth_data$Temperature))
seq(10, 37, by = 0.2)
Genotype_growth <- rep(unique(growth_data$Genotype), each = 136)
Temperature_growth <- rep(seq(10, 37, by = 0.2), times = 20)
new_data <- data.frame(Genotype = Genotype_growth, Temperature = Temperature_growth)
predict_growth <- posterior_epred(mod_3_growth,
newdata = new_data)
predict_growth <- apply(predict_growth, 2, median)
predict_growth <- data.frame(Genotype_growth, Temperature_growth, Prediction = predict_growth)
ggplot(data = growth_data, aes(x = Temperature, y = growth_days, color = Genotype)) +
geom_point() + geom_line(data = predict_growth, aes(x = Temperature, y = Prediction, color = Genotype))
ggplot(data = growth_data, aes(x = Temperature, y = growth_days, color = Genotype)) +
geom_point() + geom_line(data = predict_growth, aes(x = Temperature, y = Prediction))
ggplot(data = growth_data, aes(x = Temperature, y = growth_days, color = Genotype)) +
geom_point()
ggplot(data = growth_data, aes(x = Temperature, y = growth_days, color = Genotype)) +
geom_point() + geom_line(data = predict_growth, aes(x = Temperature, y = Prediction), inherit.aes = FALSE)
ggplot(data = growth_data, aes(x = Temperature, y = growth_days, color = Genotype)) +
geom_point() + geom_line(data = predict_growth, aes(x = Temperature_growth, y = Prediction), inherit.aes = FALSE)
ggplot(data = growth_data, aes(x = Temperature, y = growth_days, color = Genotype)) +
geom_point() + geom_line(data = predict_growth, aes(x = Temperature_growth, y = Prediction, color = Genotype_growth), inherit.aes = FALSE)
rm(list = ls())
rstan:::rstudio_stanc("Actin2Hierarchical.stan")
rstan:::rstudio_stanc("Actin2Hierarchical.stan")
rstan:::rstudio_stanc("Actin2Hierarchical.stan")
rstan:::rstudio_stanc("Actin2Hierarchical.stan")
rstan:::rstudio_stanc("Actin2Hierarchical.stan")
rstan:::rstudio_stanc("Actin2Hierarchical.stan")
rstan:::rstudio_stanc("Actin2Hierarchical.stan")
rstan:::rstudio_stanc("Actin2Hierarchical.stan")
library(ggplot2); library(cowplot); library(cmdstanr); library()
growth_data <- read.csv("StartPop_TPC.csv")
library(ggplot2); library(cowplot); library(cmdstanr); library(dplyr);
growth_data <- read.csv("StartPop_TPC.csv")
growth_data <- growth_data %>% filter(Genotype != 'blank')
growth_data <- growth_data %>% filter(!is.na(Growth.Rate.Hours) & is.finite(Growth.Rate.Hours))
growth_data <- growth_data %>% mutate(growth_days = Growth.Rate.Hours*24)
ggplot(data = growth_data, aes(x = Temperature, y = growth_days, color = Genotype)) +
geom_point() + geom_smooth(method = 'gam', formula = y ~ s(x, bs = 'tp', k = 6), se = FALSE)
library(ggplot2); library(cowplot); library(cmdstanr); library(dplyr); library(tidyr)
?pivot_wider
pivot_wider(growth_data, names_from = Genotype, values_from = growth_days)
try <- pivot_wider(growth_data, names_from = Genotype, values_from = growth_days)
View(try)
growth_data %>% group_by(Genotype) %>% summarise(number = n(
))
number_observations <- growth_data %>% group_by(Genotype) %>% summarise(number = n())
growth_obs <- matrix(nrow = 20, ncol = 42)
growth_data %>% filter(Genotype == unique(growth_data$Genotype)[1]) %>% pull(growth_days)
unique(growth_data$Genotype)
growth_data %>% filter(Genotype == '120') %>% pull(growth_days)
for(i in 1:20){
growth_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% pull(growth_days)
}
number_observations
growth_data %>% arrange(Genotype)
number_observations
growth_data <- growth_data %>% arrange(Genotype)
unique(growth_data$Genotype)[1]
unique(growth_data$Genotype)[2]
unique(growth_data$Genotype)[3]
growth_obs <- matrix(nrow = 20, ncol = 42)
for(i in 1:20){
if(number_observations$number < 42){
growth_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% c(pull(growth_days),rep(NA, times = 42 - number_observations$number[i]))
} else {
growth_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% pull(growth_days)
}
}
for(i in 1:20){
if(number_observations$number[i] < 42){
growth_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% c(pull(growth_days),rep(NA, times = 42 - number_observations$number[i]))
} else {
growth_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% pull(growth_days)
}
}
for(i in 1:20){
if(number_observations$number[i] < 42){
growth_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% c(pull(.$growth_days),rep(NA, times = 42 - number_observations$number[i]))
} else {
growth_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% pull(.$growth_days)
}
}
growth_obs <- matrix(nrow = 20, ncol = 42)
for(i in 1:20){
if(number_observations$number[i] < 42){
growth_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% pull(growth_days) %>% c(.,rep(NA, times = 42 - number_observations$number[i]))
} else {
growth_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% pull(growth_days)
}
}
View(growth_obs)
temp_obs <- matrix(nrow = 20, ncol = 42)
for(i in 1:20){
if(number_observations$number[i] < 42){
temp_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% pull(Temperature) %>% c(.,rep(NA, times = 42 - number_observations$number[i]))
} else {
temp_obs[i,] <- growth_data %>% filter(Genotype == unique(growth_data$Genotype)[i]) %>% pull(Temperature)
}
}
plot(x = temp_obs[1,], y = growth_obs[1,])
plot(x = temp_obs[3,], y = growth_obs[3,])
plot(x = temp_obs[12,], y = growth_obs[12,])
stan_data <- list(maxobs = 42,
n_genotypes = 20,
growth = growth_obs,
temp = temp_obs,
n_obs = number_observations$number)
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 1000,
iter_sampling = 1000
)
growth_obs
growth_data <- growth_data %>% arrange(Genotype)
as.numeric(growth_data$Genotype)
as.factor(growth_data$Genotype)
as.numeric(as.factor(growth_data$Genotype))
growth_data$Genotype <- as.factor(growth_data$Genotype)
stan_data <- list(N = nrows(growth_data),
n_genotypes = 20,
growth = growth_data$growth_days,
temp = growth_data$Temperature,
genotype = as.numeric(growth_data$Genotype))
stan_data <- list(N = nrow(growth_data),
n_genotypes = 20,
growth = growth_data$growth_days,
temp = growth_data$Temperature,
genotype = as.numeric(growth_data$Genotype))
View(stan_data)
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
stan_data <- list(N = nrow(growth_data),
n_genotypes = 20,
growth = growth_data$growth_days,
temp = growth_data$Temperature,
genotype = as.numeric(growth_data$Genotype))
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 1000,
iter_sampling = 1000
)
fit$summary()
print(n = 100, fit$summary())
draws_df <- fit$draws(format = "df")
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 5000,
iter_sampling = 1000
)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 5000,
iter_sampling = 1000
)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 5000,
iter_sampling = 1000
)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 2000,
iter_sampling = 1000
)
print(n = 100, fit$summary())
View(growth_data)
as.numeric(growth_data$Genotype)
growth_data$Temperature
growth_data$growth_days
nrow(growth_data)
n_genotypes = 20
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 2000,
iter_sampling = 1000
)
print(n = 100, fit$summary())
growth_data$growth_days
growth_data$Temperature
as.numeric(growth_data$Genotype)
plot(x = growth_data$Temperature, y =growth_data$growth_days)
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
stan_data <- list(N = nrow(growth_data),
n_genotypes = 20,
growth = growth_data$growth_days,
temp = growth_data$Temperature,
genotype = as.numeric(growth_data$Genotype))
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 2000,
iter_sampling = 1000
)
print(n = 100, fit$summary())
draws_df <- fit$draws(format = "df")
fit <- mod$sample(
data = stan_data,
chains = 3,
parallel_chains = 3,
refresh = 1,
iter_warmup = 2000,
iter_sampling = 1000
)
print(n = 100, fit$summary())
?cmdstanr
View(draws_df)
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
stan_data <- list(N = nrow(growth_data),
n_genotypes = 20,
growth = growth_data$growth_days,
temp = growth_data$Temperature,
genotype = as.numeric(growth_data$Genotype))
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 3,
parallel_chains = 3,
refresh = 1,
iter_warmup = 2000,
iter_sampling = 1000
)
print(n = 100, fit$summary())
draws_df <- fit$draws(format = "df")
draws_df$mu_Tmax
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 3,
parallel_chains = 3,
refresh = 1,
iter_warmup = 2000,
iter_sampling = 1000
)
read_cmdstan_csv()
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 1000,
iter_sampling = 1000
)
print(n = 100, fit$summary())
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 1000,
iter_sampling = 1000
)
print(n = 100, fit$summary())
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 1000,
iter_sampling = 1000
)
print(n = 100, fit$summary())
as.numeric(growth_data$Genotype)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 1000,
iter_sampling = 1000,
init = list(list(mu_rho = 0.05, mu_Tmax = 40, mu_delta = 5, mu_lambda = -1))
)
print(n = 100, fit$summary())
print(n = 100, fit$summary())
stan_data <- list(N = nrow(growth_data),
n_genotypes = 20,
growth = growth_data$growth_days,
temp = growth_data$Temperature,
genotype = as.numeric(growth_data$Genotype))
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 1,
iter_warmup = 1000,
iter_sampling = 1000,
init = list(list(mu_rho = 0.05, mu_Tmax = 40, mu_delta = 5, mu_lambda = -1))
)
View(stan_data)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 100,
iter_warmup = 1000,
iter_sampling = 1000,
init = list(list(mu_rho = 0.05, mu_Tmax = 40, mu_delta = 5, mu_lambda = -1))
)
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 100,
iter_warmup = 1000,
iter_sampling = 1000,
init = list(list(mu_rho = 0.05, mu_Tmax = 40, mu_delta = 5, mu_lambda = -1))
)
print(n = 100, fit$summary())
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/-0.7)) + -1.57
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 100,
iter_warmup = 10000,
iter_sampling = 1000,
init = list(list(mu_rho = 0.05, mu_Tmax = 40, mu_delta = 5, mu_lambda = -1))
)
print(n = 100, fit$summary())
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 100,
iter_warmup = 10000,
iter_sampling = 1000,
init = list(list(mu_rho = 0.5, mu_Tmax = 40, mu_delta = 5, mu_lambda = -1))
)
print(n = 100, fit$summary())
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/-0.7)) + -1.57
hist(growth_data$growth_days)
is.finite(growth_data$growth_days)
is.finite(growth_data$Temperature)
setwd("~/GitHub/FR_n-prey-at-a-time/ms/PlasticityandGrowth_Paramecium")
library(ggplot2); library(cowplot); library(cmdstanr); library(dplyr); library(tidyr)
growth_data <- read.csv("StartPop_TPC.csv")
growth_data <- growth_data %>% filter(Genotype != 'blank')
growth_data <- growth_data %>% filter(!is.na(Growth.Rate.Hours) & is.finite(Growth.Rate.Hours))
growth_data <- growth_data %>% mutate(growth_days = Growth.Rate.Hours*24)
ggplot(data = growth_data, aes(x = Temperature, y = growth_days, color = Genotype)) +
geom_point() + geom_smooth(method = 'gam', formula = y ~ s(x, bs = 'tp', k = 6), se = FALSE)
growth_data <- growth_data %>% arrange(Genotype)
growth_data$Genotype <- as.factor(growth_data$Genotype)
stan_data <- list(N = nrow(growth_data),
n_genotypes = 20,
growth = growth_data$growth_days,
temp = growth_data$Temperature,
genotype = as.numeric(growth_data$Genotype))
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 100,
iter_warmup = 10000,
iter_sampling = 1000,
init = list(list(mu_rho = 0.5, mu_Tmax = 40, mu_delta = 5, mu_lambda = -1))
)
print(n = 100, fit$summary())
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/0.7)) + -1.57
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/1.75)) + -1.57
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/-10)) + -1.57
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/-20)) + -1.57
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/20)) + -1.57
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/0.01)) + -1.57
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/0.001)) + -1.57
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/5)) + -1.57
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 100,
iter_warmup = 10000,
iter_sampling = 1000,
init = list(list(mu_rho = 0.5, mu_Tmax = 40, mu_delta = -1, mu_lambda = -1))
)
print(n = 100, fit$summary())
exp(0.267*10) - exp(0.267*10 - ((1.1 - 10)/1)) + -1.57
rstan:::rstudio_stanc("Lactin2Hierarchical.stan")
stanmodel <- 'Lactin2Hierarchical.stan'
mod <- cmdstan_model(stan_file = stanmodel)
fit <- mod$sample(
data = stan_data,
chains = 1,
parallel_chains = 1,
refresh = 100,
iter_warmup = 10000,
iter_sampling = 1000,
init = list(list(mu_rho = 0.5, mu_Tmax = 40, mu_delta = -1, mu_lambda = -1))
)
print(n = 100, fit$summary())
